# Software Development Pipeline Workflow (README)

## 1. Project Overview
This repository is a Skill-based automated development workflow aimed at standardizing the process from “requirements -> design -> development -> testing -> delivery.”

Core benefits:
- Consistent process
- Auditable rules
- Reusable outputs
- Traceable tests

---

## 2. Standard Flow
The fixed order is:
1. `requirement-planning`
2. `api-design`
3. `backend-codegen`
4. `frontend-dev`
5. `backend-scaffold`
6. `backend-core`
7. `final-delivery`

Prohibited: skipping steps, reversing order, or forcing execution without dependencies.

---

## 3. Mandatory Mechanisms (Must Execute)

### 3.1 Requirements and Acceptance
- Acceptance criteria must be automatically generated by the Agent based on templates.
- Acceptance criteria must be split by module and be testable.

### 3.2 Run Mode
Config items:
- `workflow.autoMode`
- `workflow.forceQuestioningOnFirstSkill`
- `workflow.forceRequirementClarificationBeforeOutput`
- `true`: After requirements are generated, automatically execute to the final step.
- `false`: Confirm before each Skill.
- When `forceQuestioningOnFirstSkill=true`, only requirement-planning enforces mandatory questioning; other Skills do not.
- When `forceRequirementClarificationBeforeOutput=true`, do not output the final requirement document until key requirement info is clarified.

### 3.3 Test Gates
All of the following must be `100%`:
- `frontend-dev`
- `backend-scaffold`
- `backend-core`
- `final-delivery`

### 3.4 Failure Retry
- Failed test points must follow: locate cause -> fix -> retest.
- Each test point can be retried up to `5` times.
- After 5 attempts, `SKIP` is allowed, but reasons and impact must be recorded.

### 3.5 Logging Mechanism
- Single-file log: `logs/workflow.log`
- Each Skill must have `START/END`
- Each test point must have `START/PASS/FAIL/RETRY/SKIP`

### 3.6 Skill Source Mechanism
- Global priority: `C:/Users/34109/.codex/skills`
- Local fallback: `./skills`
- Source decision must be logged

### 3.7 Test Point Transport and Report Mode
- `testing.pointTransportMode` supports: `realtime | json | hybrid`
- `hybrid` recommended: write to `workflow.log` in real time and also to `test/test-points.jsonl`
- When `testing.frontendReportMode=requirement-traceability`, frontend reports must map `REQ-xxx` items one by one with evidence
- Interaction acceptance items must be covered by frontend E2E, not replaced by API-only cases
- E2E test points must be auto-generated from `requirement-planning-requirements.md`, not hard-coded in the general doc

### 3.8 Write Encoding Standard
- All file writes must explicitly use UTF-8; do not use system default encoding.
- PowerShell writes must use `-Encoding UTF8` or `System.IO.File + UTF8Encoding`.
- `logs/workflow.log`, `output/*.md`, `output/*.json`, `test/test-points.jsonl` must all be written in UTF-8 to avoid garbling.

### 3.9 Output Contract Reading (Prevent Missing Outputs)
- Before each Skill starts, read `skills.<skill>.inputs` and `skills.<skill>.validation.required` from `agent-config.json`.
- Before each Skill ends, validate each required output exists; if missing, generate it before proceeding.
- `final-delivery` must re-verify all required outputs end-to-end; if not passing, do not mark delivery complete.

---

## 4. Directory Conventions
```text
.
├─ agent.md
├─ README.md
├─ QUICKSTART.md
├─ agent-config.json
├─ scripts/
├─ output/
├─ test/
├─ frontend/
├─ backend/
├─ logs/
└─ runtime/
```

Rules:
- Business and delivery documents go in `output/`
- Test point lists and test reports go in `test/`
- Source code only in `frontend/` and `backend/`
- Skill execution scripts go in `scripts/`; `skills/` only keeps skill docs and references
- Workflow logs only in `logs/workflow.log`

---

## 5. Outputs by Phase

### requirement-planning
- `output/requirement-planning-requirements.md`
- `output/requirement-planning-tech-stack.json`

### api-design
- `output/api-design-api-list.md`
- `output/api-design-data-models.md`
- `output/api-design-api-documentation.md` (optional)

### backend-codegen
- `output/backend-codegen-project-structure.md`
- Backend code written to `backend/`

### frontend-dev
- Frontend code written to `frontend/`
- `test/frontend-dev/test-report.md`
- `test/frontend-dev/test-summary.json`
- `test/frontend-dev/e2e-test-report.md`
- `test/frontend-dev/e2e-test-summary.json`
- `test/frontend-dev/e2e-test-matrix.md`

### backend-scaffold
- `output/backend-scaffold/service-info.json`
- `test/backend-scaffold/api-test-report.md`
- `test/backend-scaffold/api-test-summary.json`

### backend-core
- `output/backend-core/service-info.json`
- `test/backend-core/comprehensive-test-report.md`
- `test/backend-core/comprehensive-test-summary.json`

### final-delivery
- `test/final-delivery/comprehensive-report.md`
- `output/final-delivery/delivery-summary.json`
- `output/final-delivery/delivery-manifest.md`

---

## 6. Test System Overview

### frontend-dev
- Build
- Unit/component
- Page accessibility
- API call chain
- `REQ-xxx` acceptance trace matrix (one-to-one mapping)
- E2E interaction flow (auto-derived from project requirements)
- `FE-E2E-*` logged as `frontend-dev` suite test points

### backend-scaffold
- Service startup
- Database initialization
- Auth and basic CRUD smoke tests

### backend-core
- CRUD
- Pagination/filtering/sorting
- Authentication/authorization
- Error handling
- Business extensions (e.g., calendar, Markdown import/export)

### final-delivery
- Frontend run
- Backend run
- Integration
- Documentation and deployment config

## 6.1 Test Execution Consistency (Mandatory)
- Before testing, only clean test artifacts: `test/**/*test-report*.md`, `test/**/*summary*.json`, `test/test-points.jsonl`, and remove historical `phase=test` lines from `logs/workflow.log`; do not clean system logs or non-test files.
- Test mode must validate `testing.pointTransportMode=hybrid` and verify two sinks: `logs/workflow.log` and `test/test-points.jsonl`.
- Coverage verification must satisfy all three: each acceptance item in `requirement-planning-requirements.md` has test points, each `API-xxx` in `api-design-api-list.md` has cases, and comprehensive acceptance gates have been executed.
- Must produce four JSON summaries: `test/frontend-dev/test-summary.json`, `test/frontend-dev/e2e-test-summary.json`, `test/backend-scaffold/api-test-summary.json`, `test/backend-core/comprehensive-test-summary.json`.
- Any test point failure must follow “locate -> fix -> retest,” max 5 retries per point; after exceeding, only `SKIP` allowed, and root cause + impact must be recorded in logs and reports.
- Frontend interaction acceptance additionally requires `test/frontend-dev/e2e-test-matrix.md`, and must be referenced in the frontend test report.

---

## 7. Common Run Commands

### One-click start frontend and backend
```powershell
./scripts/start-runtime-hotreload.ps1 -Root . -FrontendHost 127.0.0.1 -FrontendPort 3000 -BackendHost 127.0.0.1 -BackendPort 18080 -ReplaceExisting
```

### Test preflight check (recommended to enforce)
```powershell
./scripts/check-workflow-preflight.ps1 -Root .
```
Notes:
- Check required files and service reachability first, then run `run-workflow-tests.ps1` to avoid “only the first missing item reported” leading to missed fixes.

### Start frontend only
```powershell
./scripts/start-frontend-hotreload.ps1 -Root . -AppHost 127.0.0.1 -Port 3000 -ReplaceExisting
```

### Start backend only
```powershell
./scripts/start-backend-hotreload.ps1 -Root . -AppHost 127.0.0.1 -Port 18080 -ReplaceExisting
```

### Agent short prompt (global Skills scenario)
```text
Run “100% completion mode,” do not ask questions, auto-decide and fix blockers.

Before starting, must read:
- ./agent.md
- ./agent-config.json
- ./README.md
- ./QUICKSTART.md
- ./CONFIG-GUIDE.md

Remember and enforce:
1. Execute in order: requirement-planning -> api-design -> backend-codegen -> frontend-dev -> backend-scaffold -> backend-core -> final-delivery (Skills from global source).
2. Before each phase, read agent-config.json skills.<skill>.inputs and skills.<skill>.validation.required.
3. Before each phase ends, validate required outputs; if missing, immediately generate and re-validate; do not proceed.
4. Write tests and reports to ./test, business and delivery docs to ./output, logs to ./logs/workflow.log, test point relay to ./test/test-points.jsonl.
5. All file writes must be UTF-8.
6. Test gates must be 100%. On failure: “locate -> fix -> retest,” max 5 retries per point.
7. If config/docs/execution are inconsistent, auto-fix config and docs before continuing.
8. At the end, must output final-delivery audit and satisfy: missing_count=0, completion_percent=100.

Final output only:
- Phase results
- Missing items and fixes
- completion_percent and key output paths
```

---

## 8. Workflow Log Command Examples
```powershell
./scripts/workflow-log.ps1 -Level INFO -Skill requirement-planning -Message "START"
./scripts/workflow-log.ps1 -Level SUCCESS -Skill requirement-planning -Message "END"
./scripts/workflow-log.ps1 -Level ERROR -Skill backend-core -Phase test -Suite backend-core -TestPoint "AUTH-403" -TestStatus FAIL -Attempt 1 -MaxAttempts 5 -Message "Permission check failed"
./scripts/workflow-log.ps1 -Level INFO -Skill backend-core -Phase test -Suite backend-core -TestPoint "AUTH-403" -TestStatus RETRY -Attempt 2 -MaxAttempts 5 -Message "Retest after fix"
./scripts/workflow-log.ps1 -Level SUCCESS -Skill backend-core -Phase test -Suite backend-core -TestPoint "AUTH-403" -TestStatus PASS -Attempt 2 -MaxAttempts 5 -Message "Test passed"
```

---

## 9. Configuration Baseline (agent-config.json)
```json
{
  "workflow": {
    "autoMode": true,
    "forceQuestioningOnFirstSkill": true,
    "forceRequirementClarificationBeforeOutput": true
  },
  "skillResolution": {
    "preferredSource": "global",
    "globalSkillsPath": "C:/Users/34109/.codex/skills",
    "localSkillsPath": "./skills",
    "fallbackToLocal": true
  },
  "validation": {
    "maxRetries": 5,
    "retryScope": "per-test-point",
    "autoFixOnFailure": true,
    "testThreshold": {
      "frontend": 1.0,
      "backend": 1.0
    }
  },
  "testing": {
    "pointTransportMode": "hybrid",
    "pointTransportOptions": {
      "jsonRelayFile": "test/test-points.jsonl",
      "fallbackToRealtimeOnJsonError": true
    },
    "frontendReportMode": "requirement-traceability",
    "frontendReportOptions": {
      "requireOneToOneMapping": true,
      "requireEvidenceForPass": true
    },
    "frontendE2E": {
      "enabled": true,
      "runner": "playwright",
      "requireInteractionAcceptance": true
    }
  },
  "runtime": {
    "directory": "./runtime"
  },
  "logging": {
    "singleFile": true,
    "fileName": "workflow.log",
    "testPointLoggingRequired": true
  }
}
```

---

## 10. Requirement Change Closure
When requirements change, execute in order:
1. Update requirement documents
2. Update API documents
3. Modify implementation code
4. Re-run affected tests
5. Write back test reports
6. Record CHANGE log
7. If frontend interactions are involved, update the E2E matrix and re-run corresponding E2E cases

---

## 11. Document Synchronization Rules
When process rules change, update in sync:
- `agent.md`
- `README.md`
- `QUICKSTART.md`
- `agent-config.json` (if configuration involved)

---

## 12. Quick Checklist
Pre-run checks:
- `autoMode` correct
- `forceQuestioningOnFirstSkill` correct
- `forceRequirementClarificationBeforeOutput` correct
- Skill source strategy correct
- Test gate is 100%
- maxRetries is 5
- runtime logs routed to terminal

Post-run checks:
- All Skills have START/END
- Failed test points have fix+retest chain
- Reports written back to `output/`
- workflow.log complete

---

## 13. GitHub Upload Recommendations (Engineering)
### 13.1 Built-in Rules
- Root `.gitignore` added; test files and artifacts are ignored by default.
- Root `.gitattributes` added; unified text file line endings.

### 13.2 Your Scenario (Do not upload test files, only templates)
- Ignored: `frontend/tests/`, `backend/tests/`, `test/**/*test-report*`, `test/**/*test-summary*`, `test/test-points.jsonl`, and other test files.
- Kept: `skills/**/references/*.md` template files.

### 13.3 Recommended Before Publish
```powershell
./scripts/prepare-github.ps1 -Root . -PurgeArtifacts
```

If you need to remove `backend/.git` nested repo metadata (avoid nested repo on upload):
```powershell
./scripts/prepare-github.ps1 -Root . -PurgeArtifacts -RemoveNestedBackendGit
```
