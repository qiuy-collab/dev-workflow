# QUICKSTART (Full Specification)

## 1. Use Cases
For first-time onboarding to this workflow, complete the shortest path:
- Configuration validation
- Service startup
- Sequential Skill execution
- Test and log persistence

---

## 2. Preflight Checks

### 2.1 Required Files
- `agent.md`
- `README.md`
- `QUICKSTART.md`
- `agent-config.json`
- `scripts/workflow-log.ps1`

### 2.2 Required Directories
- `output/`
- `test/`
- `logs/`
- `scripts/`
- `frontend/`
- `backend/`

### 2.3 Minimum Configuration Baseline
```json
{
  "workflow": {
    "autoMode": true,
    "forceQuestioningOnFirstSkill": true,
    "forceRequirementClarificationBeforeOutput": true
  },
  "validation": {
    "maxRetries": 5,
    "retryScope": "per-test-point",
    "autoFixOnFailure": true,
    "testThreshold": {
      "frontend": 1.0,
      "backend": 1.0
    }
  },
  "testing": {
    "pointTransportMode": "hybrid",
    "pointTransportOptions": {
      "jsonRelayFile": "test/test-points.jsonl",
      "fallbackToRealtimeOnJsonError": true
    },
    "frontendReportMode": "requirement-traceability",
    "frontendReportOptions": {
      "requireOneToOneMapping": true,
      "requireEvidenceForPass": true
    },
    "uiQualityCheck": {
      "mode": "script",
      "requireAllPages": true
    }
  },
  "runtime": {
    "directory": "./runtime"
  },
  "logging": {
    "writeEnabled": true,
    "singleFile": true,
    "fileName": "workflow.log",
    "testPointLoggingRequired": true
  }
}
```

---

## 3. One-Click Start

### 3.1 Start Frontend/Backend Hot Reload
```powershell
./scripts/start-runtime-hotreload.ps1 -Root . -FrontendHost 127.0.0.1 -FrontendPort 3000 -BackendHost 127.0.0.1 -BackendPort 18080 -ReplaceExisting
```

### 3.2 Notes
- The startup script only starts services and hot reload.

### 3.3 Test Preflight Check (Mandatory)
```powershell
./scripts/check-workflow-preflight.ps1 -Root .
```
- If the preflight check fails, fill missing files or fix service reachability before testing.

---

## 4. Skill Execution Order
Execute in the following order:
1. requirement-planning
2. api-design
3. backend-codegen
4. ui-ux-pro-max-local
5. frontend-dev
6. backend-scaffold
7. backend-core
8. final-delivery

### 4.1 Required Before Each Phase (Prevent Missing Outputs)
- Open `agent-config.json`, read for the current Skill:
  - `skills.<skill>.inputs`
  - `skills.<skill>.validation.required`
- Convert the required list into a checklist; verify file existence at phase end.
- If any required file is missing: record `ERROR`, generate missing outputs, then proceed.

---

## 5. Mandatory Mechanisms Quick Reference

### 5.1 Requirements
- Acceptance criteria must be auto-generated by the Agent (by module).
- Acceptance criteria are auto-generated; do not ask the user for them.

### 5.1B Functional Supplements (Mandatory)
- After the user states initial core features, embed option-select “functional supplements” into the questioning.
- Users must be able to choose or add missing functions; do not auto-assume.
- Summarize selections and confirm before moving forward.

### 5.1A UI Visualization and Confirmation (Mandatory)
- After completing the 5 core questions, generate a page list from confirmed requirements and user flow.
- Produce an ASCII component visualization per page using `skills/requirement-planning/references/ui-component-ascii-template.md`.
- Force user confirmation in order:
  - Confirm component positions (iterate until confirmed).
  - Confirm UI style (e.g., iOS / minimalist / grand / other) (iterate until confirmed).
- After confirmations, output requirement-stage UI drafts:
  - `output/ui/ui-spec.md`
  - `output/ui/ui-tokens.json`
  - `output/ui/ui-quality-metrics.md`
- Do not proceed to the next phase or Skill until all confirmations are explicit.

### 5.2 Modes
- autoMode=true: full auto to the end.
- autoMode=false: confirm each step.
- forceQuestioningOnFirstSkill=true: only the first Skill (requirement-planning) enforces questioning.
- forceRequirementClarificationBeforeOutput=true: do not output final requirements until key info is clarified.

### 5.3 Test Gates
- frontend-dev / backend-scaffold / backend-core / final-delivery: 100%.

### 5.4 Failure Handling
- Failed points must be fixed and retested.
- Max 5 retries per point.
- After limit, SKIP is allowed but must be logged.

### 5.4A No Fake Tests / No Fabricated Reports
- Reports and summaries must be produced from real test executions only.
- It is forbidden to claim PASS/100% without actually running services and tests.
- If a test cannot be executed, record FAIL or SKIP with evidence and impact.

### 5.5 Logging
- Single file: `logs/workflow.log`
- Skill level: START/END
- Test points: START/PASS/FAIL/RETRY/SKIP
- If `logs/workflow.log` is missing, create it immediately and log an ERROR.

### 5.6 Skill Source
- Global priority, local fallback if needed.

### 5.7 Test Point Transport Mode
- `testing.pointTransportMode=realtime`: write only `workflow.log`
- `testing.pointTransportMode=json`: write only `test/test-points.jsonl`
- `testing.pointTransportMode=hybrid`: write both (recommended)
- If JSON write fails and `fallbackToRealtimeOnJsonError=true`, fall back to realtime logs

### 5.8 Frontend Report Mode
- `testing.frontendReportMode=requirement-traceability`: must validate each `REQ-xxx` with evidence
- `testing.frontendReportMode=smoke-summary`: smoke summary only (not recommended for gatekeeping)

### 5.9 Test Execution Consistency (Mandatory)
- Before testing, only clean test artifacts: `test/**/*test-report*.md`, `test/**/*summary*.json`, `test/test-points.jsonl`, and remove historical `phase=test` lines from `logs/workflow.log`; do not clean system logs or non-test files.
- Test mode must validate `testing.pointTransportMode=hybrid` and verify two sinks: `logs/workflow.log` and `test/test-points.jsonl`.
- Coverage verification must satisfy all three: each acceptance item in `requirement-planning-requirements.md` has test points, each `API-xxx` in `api-design-api-list.md` has cases, and comprehensive acceptance gates have been executed.
- Must produce four JSON summaries: `test/frontend-dev/test-summary.json`, `test/frontend-dev/e2e-test-summary.json`, `test/backend-scaffold/api-test-summary.json`, `test/backend-core/comprehensive-test-summary.json`.
- Any test point failure must follow “locate -> fix -> retest,” max 5 retries per point; after exceeding, only `SKIP` allowed, and root cause + impact must be recorded in logs and reports.
- Each PASS must include evidence from the same run (command output, response, screenshot, or log reference).
- You must pass `check-workflow-preflight.ps1` before running `run-workflow-tests.ps1`.
- `run-workflow-tests.ps1` and `final-delivery.ps1` must run sequentially (both write `test/test-points.jsonl`).
- UI quality checks are executed only in `final-delivery` using `testing.uiQualityCheck.mode` (default `script`).
- Evidence format depends on mode: script logs/assertions or DevTools MCP screenshots/logs, and must be referenced in the final comprehensive report.
- Scope: spacing consistency on all pages, style consistency for at least 4 component types (Button/Input/Card/List), and interaction states (hover/active/focus/disabled).

### 5.10 Frontend E2E Interaction Acceptance (Mandatory)
- Interaction acceptance items must be covered by frontend E2E, not replaced by API-only cases.
- E2E test points are auto-generated from `output/requirement-planning-requirements.md`, not hard-coded in generic docs.
- Must produce `test/frontend-dev/e2e-test-matrix.md` (one-to-one mapping to `REQ-xxx-y`).
- Recommended config:
  - `testing.frontendE2E.enabled=true`
  - `testing.frontendE2E.runner=playwright`
  - `testing.frontendE2E.requireInteractionAcceptance=true`

### 5.11 UTF-8 Write Rules (Mandatory)
- All file writes must explicitly use UTF-8.
- PowerShell scripts use `-Encoding UTF8` or `System.IO.File + UTF8Encoding`.
- If you add scripts that write logs/reports/JSON, verify encoding before commit to avoid garbling.

---

## 6. Log Command Examples

### 6.1 Skill Lifecycle
```powershell
./scripts/workflow-log.ps1 -Level INFO -Skill requirement-planning -Message "START"
./scripts/workflow-log.ps1 -Level SUCCESS -Skill requirement-planning -Message "END"
```

### 6.2 Test Point Failure Retry
```powershell
./scripts/workflow-log.ps1 -Level ERROR -Skill backend-core -Phase test -Suite backend-core -TestPoint "MD-IMPORT" -TestStatus FAIL -Attempt 1 -MaxAttempts 5 -Message "Import failed"
./scripts/workflow-log.ps1 -Level INFO -Skill backend-core -Phase test -Suite backend-core -TestPoint "MD-IMPORT" -TestStatus RETRY -Attempt 2 -MaxAttempts 5 -Message "Retest after fix"
./scripts/workflow-log.ps1 -Level SUCCESS -Skill backend-core -Phase test -Suite backend-core -TestPoint "MD-IMPORT" -TestStatus PASS -Attempt 2 -MaxAttempts 5 -Message "Pass"
```

---

## 7. Output Checks

### 7.1 Required Files
- `output/requirement-planning-requirements.md`
- `output/requirement-planning-tech-stack.json`
- `output/ui/ui-spec.md`
- `output/ui/ui-tokens.json`
- `output/ui/ui-quality-metrics.md`
- `output/api-design-api-list.md`
- `output/api-design-data-models.md`
- `design-system/MASTER.md`
- `design-system/pages/`
- `output/ui/ui-spec.md`
- `output/ui/ui-tokens.json`
- `output/ui/ui-quality-metrics.md`
- `output/ui/frontend-ui-implementation-notes.md`
- `test/frontend-dev/test-report.md`
- `test/frontend-dev/test-summary.json`
- `test/frontend-dev/e2e-test-report.md`
- `test/frontend-dev/e2e-test-summary.json`
- `test/frontend-dev/e2e-test-matrix.md`
- `output/backend-scaffold/service-info.json`
- `test/backend-scaffold/api-test-report.md`
- `test/backend-scaffold/api-test-summary.json`
- `output/backend-core/service-info.json`
- `test/backend-core/comprehensive-test-report.md`
- `test/backend-core/comprehensive-test-summary.json`
- `test/final-delivery/comprehensive-report.md`
- `output/final-delivery/delivery-summary.json`
- `output/final-delivery/delivery-manifest.md`

### 7.2 Log File
- `logs/workflow.log` (the only workflow log)

---

## 8. What To Do When Requirements Change
Execute in order:
1. Update requirement documents
2. Update API documents (if impacted)
3. Modify code
4. Re-run affected tests
5. Write back test reports
6. Record CHANGE log
7. If frontend interactions are involved, update the E2E matrix and re-run corresponding E2E cases

---

## 9. FAQ

### Q1: I cannot see output after startup. What should I do?
A: Check whether the terminal window is minimized, or view output in the IDE terminal panel.

### Q2: Can I continue if tests are not 100%?
A: No. You must fix to 100%, or record SKIP per rules.

### Q3: When should I use local skills?
A: Only when global skills are unavailable.

### Q4: Will autoMode=false still auto-run to the end?
A: No. Each Skill requires confirmation.

### Q5: How to ensure “only the first Skill enforces questioning” is not forgotten?
A: Set `forceQuestioningOnFirstSkill` to `true` and verify config before execution.

### Q6: Why does the frontend report not show one-by-one acceptance?
A: Usually the report mode is not `requirement-traceability`, or only build/unit tests ran without REQ mapping.

---

## 10. Final Checklist
- [ ] Mandatory mechanisms enabled
- [ ] Skill order correct
- [ ] All key reports generated
- [ ] Test gates at 100%
- [ ] workflow.log complete
- [ ] Change closure recorded
